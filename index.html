<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kalkulator Patungan</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input { margin: 5px; padding: 5px; width: 120px; }
    .person { margin-bottom: 10px; }
    button { padding: 6px 12px; margin-top: 10px; }
    hr { margin: 20px 0; }
  </style>
</head>
<body>
  <h2>üí∏ Kalkulator Patungan Otomatis</h2>

  <div id="people"></div>
  <button onclick="addPerson()">+ Tambah Item</button>

  <hr>
  <label>Subtotal Barang (tanpa fee/diskon): <input type="number" id="subtotal" value="97601"></label><br>
  <label>Total Biaya Tambahan (tax, ongkir, dll): <input type="number" id="extraFees" value="16873"></label><br>
  <label>Total Diskon (semua): <input type="number" id="discount" value="26400"></label><br>
  <button onclick="hitung()">üí∞ Hitung Patungan</button>

  <h3>üí≥ Hasil Patungan:</h3>
  <div id="result"></div>

  <script>
    const peopleDiv = document.getElementById("people");

    function addPerson(name = '', price = '') {
      const div = document.createElement('div');
      div.className = 'person';
      div.innerHTML = `
        <input type="text" placeholder="Nama Menu" value="${name}">
        <input type="number" placeholder="Harga (Rp)" value="${price}">
        <button onclick="this.parentElement.remove()">‚ùå</button>
      `;
      peopleDiv.appendChild(div);
    }

    // Preload data dari struk
    addPerson("Kopsu Coco", 20900);
    addPerson("Black Tea Machiato", 18900);
    addPerson("Americano", 29901);
    addPerson("Aero Berrycano", 27900);

    function hitung() {
      const people = Array.from(document.querySelectorAll(".person"));
      const subtotal = parseFloat(document.getElementById("subtotal").value);
      const extraFees = parseFloat(document.getElementById("extraFees").value);
      const discount = parseFloat(document.getElementById("discount").value);
      const totalBayar = subtotal + extraFees - discount;

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      let totalProporsi = 0;
      const data = people.map(p => {
        const name = p.querySelector("input[type='text']").value;
        const price = parseFloat(p.querySelector("input[type='number']").value);
        totalProporsi += price;
        return { name, price };
      });

      let totalHitung = 0;
      data.forEach((p, i) => {
        const proporsi = p.price / totalProporsi;
        let bayar = proporsi * totalBayar;
        if (i === data.length - 1) {
          bayar = totalBayar - totalHitung; // Sisanya biar fix total
        } else {
          bayar = Math.round(bayar);
          totalHitung += bayar;
        }
        resultDiv.innerHTML += `<p><strong>${p.name}</strong>: Rp ${bayar.toLocaleString('id-ID')}</p>`;
      });
    }
  </script>
</body>
</html>
