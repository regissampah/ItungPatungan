<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kalkulator Patungan + OCR Struk</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 40px;
      background: linear-gradient(135deg, #121212, #1f1f1f);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #e5e7eb;
    }
    .container {
      background: rgba(255, 255, 255, 0.06);
      border-radius: 20px;
      padding: 30px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    h2, h3 {
      text-align: center;
      color: #ffffff;
      font-weight: 600;
    }
    input, button {
      padding: 10px;
      border-radius: 12px;
      border: none;
      margin: 5px 0;
      font-size: 15px;
    }
    input {
      width: 100%;
      background: rgba(255, 255, 255, 0.08);
      color: #ffffff;
      border: 1px solid rgba(255,255,255,0.1);
      outline: none;
    }
    input::placeholder {
      color: #9ca3af;
    }
    input[type="file"] {
      background: transparent;
      border: none;
      color: #d1d5db;
    }
    .person {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .person input {
      flex: 1;
    }
    .person input.jumlah-orang {
      flex: 0.3;
    }
    button {
      background-color: rgba(59,130,246,0.15);
      color: #ffffff;
      cursor: pointer;
      border: 1px solid rgba(147, 197, 253, 0.2);
      transition: 0.2s ease-in-out;
    }
    button:hover {
      background-color: rgba(59,130,246,0.3);
    }
    #result {
      margin-top: 20px;
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 16px;
      color: #f3f4f6;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    #waShare {
      background: #25D366;
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 10px;
      display: inline-block;
      margin-top: 10px;
    }
    hr {
      border-color: rgba(255,255,255,0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Kalkulator Patungan</h2>
    <input type="file" id="upload" accept="image/*">
    <div id="items"></div>

    <h3>Orang yang Patungan</h3>
    <div id="people">
      <div class="person">
        <input type="text" placeholder="Nama" class="nama">
        <input type="number" placeholder="Jumlah item" class="jumlah-orang" value="1">
        <button onclick="hapusOrang(this)">Hapus</button>
      </div>
    </div>
    <button onclick="tambahOrang()">+ Tambah Orang</button>
    <hr>
    <button onclick="hitungPatungan()">Hitung Patungan</button>
    <button onclick="location.reload()">ðŸ”„ Reset</button>
    <div id="result"></div>
    <div id="share"></div>
  </div>

  <script>
    const itemsContainer = document.getElementById("items");
    const resultContainer = document.getElementById("result");
    const shareContainer = document.getElementById("share");

    document.getElementById("upload").addEventListener("change", function () {
      const file = this.files[0];
      if (!file) return;
      Tesseract.recognize(file, 'eng').then(({ data: { text } }) => {
        const lines = text.split("\n").filter(l => l.trim());
        itemsContainer.innerHTML = "";
        for (let line of lines) {
          const match = line.match(/(.+?)\s+(\d{1,3}(?:\.\d{3})*|\d+)/);
          if (match) {
            const namaItem = match[1].replace(/\b\d+\s*[xX]\b/g, '').replace(/\b\d+[xX]?\b/g, '').trim();
            const harga = match[2].replace(/\./g, "").replace(",", ".");
            itemsContainer.innerHTML += `
              <div class="person">
                <input type="text" value="${namaItem}">
                <input type="number" placeholder="Harga" value="${harga}">
              </div>
            `;
          }
        }
      });
    });

    function tambahOrang() {
      const div = document.createElement("div");
      div.className = "person";
      div.innerHTML = `
        <input type="text" placeholder="Nama" class="nama">
        <input type="number" placeholder="Jumlah item" class="jumlah-orang" value="1">
        <button onclick="hapusOrang(this)">Hapus</button>
      `;
      document.getElementById("people").appendChild(div);
    }

    function hapusOrang(btn) {
      btn.parentElement.remove();
    }

    function hitungPatungan() {
      const orangInputs = document.querySelectorAll("#people .person");
      const items = document.querySelectorAll("#items .person");
      let hargaTotal = 0;
      let hargaPerItem = [];

      items.forEach(item => {
        const harga = parseFloat(item.children[1].value);
        hargaTotal += harga;
        hargaPerItem.push(harga);
      });

      let totalOrang = 0;
      let distribusi = [];

      orangInputs.forEach(orang => {
        const nama = orang.querySelector(".nama").value || "Anonim";
        const jml = parseInt(orang.querySelector(".jumlah-orang").value);
        totalOrang += jml;
        distribusi.push({ nama, jml });
      });

      let result = `<h3>Total: Rp${hargaTotal.toLocaleString("id-ID")}</h3><ul>`;
      distribusi.forEach(o => {
        const proporsi = o.jml / totalOrang;
        const bayar = Math.round(hargaTotal * proporsi);
        result += `<li>${o.nama} bayar Rp${bayar.toLocaleString("id-ID")}</li>`;
      });
      result += "</ul>";
      resultContainer.innerHTML = result;

      const waText = encodeURIComponent(result.replace(/<[^>]+>/g, ""));
      shareContainer.innerHTML = `<a id="waShare" href="https://wa.me/?text=${waText}" target="_blank">Share ke WhatsApp</a>`;
    }
  </script>
</body>
</html>
